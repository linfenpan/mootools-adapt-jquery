// by da宗熊 2016/07/28 https://github.com/linfenpan/thenable.js
(function(a,b){if(typeof define==="function"){if(define.amd){define(b)}else{define(function(d,c,e){e.exports=b()})}}else{if(typeof exports==="object"){module.exports=b()}else{a.Thenable=b()}}}(this,function factory(){function f(l,m){for(var k in m){if(m.hasOwnProperty(k)){l[k]=m[k]}}}function e(l,n){for(var m=0,k=l.length;m<k;m++){n.call(l,l[m],m)}}function g(k){return Object.prototype.toString.call(k).split(" ")[1].slice(0,-1).toLowerCase()}function d(k){return[].slice.call(k,0)}function i(k){return k&&g(k)==="object"&&g(k.then)==="function"}var j="pending";var b="resolved";var c="rejected";function h(l){var k=this;k.state=j;k.result=null;k.runners=[];if(g(l)==="function"){l(function(m){k.resolve(m)},function(m){k.reject(m)})}}f(h.prototype,{isPedding:function(){return this.state===j},isResolved:function(){return this.state===b},isRejected:function(){return this.state===c},_exec:function(){var k=this;if(!k.isPedding()){e(k.runners,function(l){l._exec(k.result,k.state)});k.runners=[]}return k},resolve:function(l){var k=this;if(k.isPedding()){if(i(l)){l.then(function(m){k.resolve(m)},function(m){k.reject(m)})}else{k.state=b;k.result=l}}return k._exec()},reject:function(l){var k=this;if(k.isPedding()){k.state=c;k.result=l}return k._exec()},then:function(n,k){var l=this;var m=new a(l);m.then(n,k);l.runners.push(m);l._exec();return m},"catch":function(k){return this.then(null,k)}});function a(k){this.parent=k;this.result=null;this.state=j;this.runs=[]}f(a.prototype,{_exec:function(s,k){var q=this;q.state=k;if(k===j){return q}var n=q.runs;var p;while(p=n.shift()){var m=p[0],l=p[1];var r=m&&k===b;var o=l&&k===c;if(r){s=m(s)}else{if(o){s=l(s);q.state=k=b}}if((r||o)&&i(s)){q.state=j;s.then(function(t){q._exec(t,b)},function(t){q._exec(t,c)});break}q.result=s}return q},then:function(l,k){this.runs.push([l,k]);return this._exec(this.result,this.state)},"catch":function(k){return this.then(null,k)}});f(h,{reject:function(l){var k=new h();return k.reject(l)},resolve:function(l){var k=new h();return k.resolve(l)},all:function(n){if(g(n)!=="array"){n=d(arguments)}var l=new h();var o=n.length;var m=0;var k={length:o};function p(){if(m>=o){l.resolve(d(k))}}e(n,function(r,q){if(!(r instanceof h)){r=h.resolve(r)}r.then(function(s){k[q]=s;m++;p()},function(s){l.reject(s)})});p();return l},race:function(l){if(g(l)!=="array"){l=d(arguments)}var k=new h();e(l,function(m){if(!(m instanceof h)){m=h.resolve(m)}m.then(function(n){k.resolve(n)},function(n){k.reject(n)})});return k}});return h}));
