<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>mootools模拟jQuery</title>
  <script src="./mootools.js"></script>
  <script src="./mootools-adapt-jquery.js"></script>
  <style>
    * { padding: 0; margin: 0; }
    h1 { margin-top: 20px; }
    h1:first-child { margin-top: 0; }
  </style>
</head>
<body>
  <h1>DOM Ready</h1>
  <script>
    var domready = 1;
    jQuery(function() {
      domready = 2;
    });
    setTimeout(function() {
      console.assert(domready === 2, '应该运行domready方法');
    }, 1000);
  </script>

  <h1 id="jsAttr">.attr('href');</h1>
  <script>
    var $jsAttr = jQuery('#jsAttr');
    $jsAttr.attr('href', 'test');
    console.assert($jsAttr.attr('href') == 'test', '属性值，应该是 test ');
    $jsAttr.removeAttr('href');
    console.assert($jsAttr.attr('href') == null, '删除的属性，应该不存在');
  </script>

  <h1>.html()</h1>
  <div id="jsHtml">
    <span>1</span>
    &nbsp;|&nbsp;
    <span>3</span>
    &nbsp;|&nbsp;
    <span>2</span>
  </div>
  <script>
    var $jsHtml = jQuery('#jsHtml span');
    console.assert($jsHtml.html() == 1, 'html的值，应该等于第一个找到元素的值');
    $jsHtml.html('333');
    console.assert($jsHtml.html() == 333, 'html的值，应该全部变成333');
  </script>

  <h1>.text()</h1>
  <div id="jsText">
    <span>1</span>
    &nbsp;|&nbsp;
    <span>3</span>
    &nbsp;|&nbsp;
    <span>2</span>
  </div>
  <script>
    var $jsText = jQuery('#jsText span');
    console.assert($jsText.text() == 1, 'text的值，应该等于第一个找到元素的值');
    $jsText.text('333');
    console.assert($jsText.text() == 333, 'text的值，应该全部变成333');
  </script>

  <h1>.val();<br> .css();</h1>
  <div id="jsVal" style="width: 300px;">
    <input type="text" value="1" style="width:20px;" />
    &nbsp;|&nbsp;
    <input type="text" value="2" style="width:20px;" />
    &nbsp;|&nbsp;
    <input type="text" value="3" style="width:20px;" />
  </div>
  <script>
    var $jsVals = jQuery('#jsVal input');
    console.assert($jsVals.val() == 1, 'val的值，应该等于第一个找到元素的值');
    $jsVals.val('4');
    console.assert($jsVals.val() == 4, 'val的值，应该全部变成4');

    var $jsVal = jQuery('#jsVal');
    console.assert($jsVal.css('width') == '300px', '.css("width")，获取宽度失败');
    $jsVal.css('width', 500);
    console.assert($jsVal.css('width') == '500px', '.css("width", 500)，设置宽度失败');
    $jsVal.css({ width: 300 });
    console.assert($jsVal.css('width') == '300px', '.css({width: 300})，设置宽度失败');
  </script>

  <h1>.append();<br> .prepend();<br> .children;<br> .last;</h1>
  <div>append方法已经被 mootools 占用</div>
  <div id="jsAppend"></div>
  <div style="display:none">
    <span id="jsAppendChild1">1</span>
    <span id="jsAppendChild3">3</span>
    <span id="jsAppendChild4">4</span>
  </div>
  <script>
    var $jsAppend = jQuery('#jsAppend');
    $jsAppend.prepend('#jsAppendChild1');
    console.assert($jsAppend.children().length == 1, 'prepend dom，应该插入一个正确的孩子');

    $jsAppend.append('<span id="jsAppendChild2">2</span>');
    console.assert(jQuery('#jsAppendChild2').length == 1, 'append 字符串，应该插入一个正确的孩子');

    $jsAppend.append('#jsAppendChild3');
    console.assert($jsAppend.last().attr('id') == 'jsAppendChild3', 'append 参数是id时，插入不正确');

    $jsAppend.append(jQuery('#jsAppendChild4'));
    console.assert($jsAppend.last().attr('id') == 'jsAppendChild4', 'append 参数dom时，插入不正确');
  </script>

  <h1>.wrap();<br> .unwrap();<br> .eq();<br> .parent();</h1>
  <div id="jsWrap">
    <span>被wrap内容1</span>
    <span>被wrap内容2</span>
    <span>被wrap内容3</span>
  </div>
  <div style="display: none;">
    <a href="javascript:alert('wrap2');" id="jsWrapA2"></a>
    <a href="javascript:alert('wrap3');" id="jsWrapA3"></a>
  </div>
  <script>
    var $jsWraps = jQuery('#jsWrap span');
    var $jsWraps1 = $jsWraps.eq(0);
    var $jsWraps2 = $jsWraps.eq(1);
    var $jsWraps3 = $jsWraps.eq(-1);

    console.assert($jsWraps1.text().indexOf('内容1') > 0, 'eq(0)，获取的元素错误');
    console.assert($jsWraps3.text().indexOf('内容3') > 0, 'eq(-1)，获取的元素错误');

    $jsWraps1.wrap('<a href="javascript:alert(\'wrap1\');" id="jsWrapA1"></a>');
    console.assert($jsWraps1.parent().attr('id') === 'jsWrapA1', 'wrap(html)，出错');
    $jsWraps2.wrap('#jsWrapA2');
    console.assert($jsWraps2.parent().attr('id') === 'jsWrapA2', 'wrap(id)，出错');
    $jsWraps3.wrap(jQuery('#jsWrapA3'));
    console.assert($jsWraps3.parent().attr('id') === 'jsWrapA3', 'wrap(dom)，出错');
  </script>

  <h1>.remove();</h1>
  <div id="jsRemove"></div>
  <script>
    jQuery('#jsRemove').remove();
    var $jsRemove = jQuery('#jsRemove');
    console.assert($jsRemove.length == 0, 'remove 方法出错');
  </script>

  <h1>.find();<br> .next();<br> .nextAll();<br> .prev();<br> .prevAll();</h1>
  <div id="jsFind">
    <span>first</span>
    <span>second</span>
    <span>third</span>
  </div>
  <script>
    var $jsFind = jQuery('#jsFind');
    var $jsFinds = $jsFind.find('span');
    console.assert($jsFinds.length == 3, 'find() 获取子元素数目错误');
    console.assert($jsFinds.eq(0).next().length == 1, 'next() 获取不到元素');
    console.assert($jsFinds.eq(0).nextAll().length == 2, 'nextAll() 获取不到元素');
    console.assert($jsFinds.eq(2).prev().text() == 'second', 'prev()，获取元素错误');
    console.assert($jsFinds.eq(2).prevAll().length == 2, 'prevAll()，获取元素错误');
  </script>

  <h1>.on();<br> .off();<br> .trigger();</h1>
  <div id="jsEvent">
    <a href="javascript:;">点击</a>
  </div>
  <script>
    var jsEventId = 0, jsOther = 0;
    var jsEventFn = function(other) {
      jsEventId = 1;
      jsOther = other;
    };

    // 普通的绑定
    jQuery('#jsEvent').find('a').on('click', jsEventFn);
    jQuery('#jsEvent').find('a').trigger('click', [1]);
    console.assert(jsEventId == 1, 'trigger 或 on 绑定失败');
    console.assert(jsOther == 1, 'trigger 传递参数失败');

    jsEventId = 0, jsOther = 0;
    jQuery('#jsEvent').find('a').off('click');
    jQuery('#jsEvent').find('a').trigger('click', [1]);
    console.assert(jsEventId == 0, 'off 解绑失败');
    console.assert(jsOther == 0, 'off 解绑失败');

    jQuery('#jsEvent').find('a').on('click', jsEventFn);
    jQuery('#jsEvent').find('a').off('click', jsEventFn);
    jQuery('#jsEvent').find('a').trigger('click', [1]);
    console.assert(jsEventId == 0, 'off 解绑失败');
    console.assert(jsOther == 0, 'off 解绑失败');


    // 代理绑定
    jQuery('#jsEvent').on('click', 'a', function(other) {
      jsEventId = 1;
      jsOther = other;
    });
    // 代理是不能使用 trigger 触发的
    jQuery('#jsEvent').trigger('click', 'a', [1]);
    console.assert(jsEventId == 1, 'trigger 或 on 绑定失败');
    console.assert(jsOther == 1, 'trigger 或 on 绑定失败');
  </script>

  <h1>事件绑定</h1>
  <div>
    <input type="text" id="jsFocus" /> <a href="javascript:;" onclick="jQuery('#jsFocus').focus()">聚焦</a>
  </div>
  <script>
    var jsFocus = 0;
    jQuery('#jsFocus').click(function() {
      jsFocus = 1;
    });
    jQuery('#jsFocus').click();
    console.assert(jsFocus == 1, 'click 没有绑定成功，或者没有触发');
  </script>

</body>
</html>
